(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{677:function(v,_,t){"use strict";t.r(_);var e=t(6),o=Object(e.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h2",{attrs:{id:"恋爱模拟"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#恋爱模拟"}},[v._v("#")]),v._v(" 恋爱模拟")]),v._v(" "),t("p",[v._v("以谈恋爱为例，两个人能够在一起最重要的事情是首先确认各自"),t("strong",[v._v("爱")]),v._v("和"),t("strong",[v._v("被爱")]),v._v("的能力。接下来我们以此来模拟三次握手的过程。")]),v._v(" "),t("p",[v._v("第一次:")]),v._v(" "),t("p",[v._v("男: "),t("strong",[v._v("我爱你。")])]),v._v(" "),t("p",[v._v("女方收到。")]),v._v(" "),t("p",[v._v("由此证明男方拥有"),t("code",[v._v("爱")]),v._v("的能力。")]),v._v(" "),t("p",[v._v("第二次:")]),v._v(" "),t("p",[v._v("女: "),t("strong",[v._v("我收到了你的爱，我也爱你。")])]),v._v(" "),t("p",[v._v("男方收到。")]),v._v(" "),t("p",[v._v("OK，现在的情况说明，女方拥有"),t("code",[v._v("爱")]),v._v("和"),t("code",[v._v("被爱")]),v._v("的能力。")]),v._v(" "),t("p",[v._v("第三次:")]),v._v(" "),t("p",[v._v("男: "),t("strong",[v._v("我收到了你的爱。")])]),v._v(" "),t("p",[v._v("女方收到。")]),v._v(" "),t("p",[v._v("现在能够保证男方具备"),t("code",[v._v("被爱")]),v._v("的能力。")]),v._v(" "),t("p",[v._v("由此完整地确认了双方"),t("code",[v._v("爱")]),v._v("和"),t("code",[v._v("被爱")]),v._v("的能力，两人开始一段甜蜜的爱情。")]),v._v(" "),t("h2",{attrs:{id:"真实握手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#真实握手"}},[v._v("#")]),v._v(" 真实握手")]),v._v(" "),t("p",[v._v("当然刚刚那段属于扯淡，不代表本人价值观，目的是让大家理解整个握手过程的意义，因为两个过程非常相似。对应到 TCP 的三次握手，也是需要确认双方的两样能力: "),t("code",[v._v("发送的能力")]),v._v("和"),t("code",[v._v("接收的能力")]),v._v("。于是便会有下面的三次握手的过程:")]),v._v(" "),t("p",[t("img",{attrs:{src:v.$withBase("/tcp/001.jpg")}})]),v._v(" "),t("p",[v._v("从最开始双方都处于"),t("code",[v._v("CLOSED")]),v._v("状态。然后服务端开始监听某个端口，进入了"),t("code",[v._v("LISTEN")]),v._v("状态。")]),v._v(" "),t("p",[v._v("然后客户端主动发起连接，发送 SYN , 自己变成了"),t("code",[v._v("SYN-SENT")]),v._v("状态。")]),v._v(" "),t("p",[v._v("服务端接收到，返回"),t("code",[v._v("SYN")]),v._v("和"),t("code",[v._v("ACK")]),v._v("(对应客户端发来的SYN)，自己变成了"),t("code",[v._v("SYN-REVD")]),v._v("。")]),v._v(" "),t("p",[v._v("之后客户端再发送"),t("code",[v._v("ACK")]),v._v("给服务端，自己变成了"),t("code",[v._v("ESTABLISHED")]),v._v("状态；服务端收到"),t("code",[v._v("ACK")]),v._v("之后，也变成了"),t("code",[v._v("ESTABLISHED")]),v._v("状态。")]),v._v(" "),t("p",[v._v("另外需要提醒你注意的是，从图中可以看出，SYN 是需要消耗一个序列号的，下次发送对应的 ACK 序列号要加1，为什么呢？只需要记住一个规则:")]),v._v(" "),t("blockquote",[t("p",[v._v("凡是需要对端确认的，一定消耗TCP报文的序列号。")])]),v._v(" "),t("p",[v._v("SYN 需要对端的确认， 而 ACK 并不需要，因此 SYN 消耗一个序列号而 ACK 不需要。")]),v._v(" "),t("h2",{attrs:{id:"为什么不是两次"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么不是两次"}},[v._v("#")]),v._v(" 为什么不是两次？")]),v._v(" "),t("p",[v._v("根本原因: 无法确认客户端的接收能力。")]),v._v(" "),t("p",[v._v("分析如下:")]),v._v(" "),t("p",[v._v("如果是两次，你现在发了 SYN 报文想握手，但是这个包"),t("strong",[v._v("滞留")]),v._v("在了当前的网络中迟迟没有到达，TCP 以为这是丢了包，于是重传，两次握手建立好了连接。")]),v._v(" "),t("p",[v._v("看似没有问题，但是连接关闭后，如果这个"),t("strong",[v._v("滞留")]),v._v("在网路中的包到达了服务端呢？这时候由于是两次握手，服务端只要接收到然后发送相应的数据包，就默认"),t("strong",[v._v("建立连接")]),v._v("，但是现在客户端已经断开了。")]),v._v(" "),t("p",[v._v("看到问题的吧，这就带来了连接资源的浪费。")]),v._v(" "),t("h2",{attrs:{id:"为什么不是四次"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么不是四次"}},[v._v("#")]),v._v(" 为什么不是四次？")]),v._v(" "),t("p",[v._v("三次握手的目的是确认双方"),t("code",[v._v("发送")]),v._v("和"),t("code",[v._v("接收")]),v._v("的能力，那四次握手可以嘛？")]),v._v(" "),t("p",[v._v("当然可以，100 次都可以。但为了解决问题，三次就足够了，再多用处就不大了。")]),v._v(" "),t("h2",{attrs:{id:"三次握手过程中可以携带数据么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三次握手过程中可以携带数据么"}},[v._v("#")]),v._v(" 三次握手过程中可以携带数据么？")]),v._v(" "),t("p",[v._v("第三次握手的时候，可以携带。前两次握手不能携带数据。")]),v._v(" "),t("p",[v._v("如果前两次握手能够携带数据，那么一旦有人想攻击服务器，那么他只需要在第一次握手中的 SYN 报文中放大量数据，那么服务器势必会消耗更多的"),t("strong",[v._v("时间")]),v._v("和"),t("strong",[v._v("内存空间")]),v._v("去处理这些数据，增大了服务器被攻击的风险。")]),v._v(" "),t("p",[v._v("第三次握手的时候，客户端已经处于"),t("code",[v._v("ESTABLISHED")]),v._v("状态，并且已经能够确认服务器的接收、发送能力正常，这个时候相对安全了，可以携带数据。")]),v._v(" "),t("h2",{attrs:{id:"同时打开会怎样"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同时打开会怎样"}},[v._v("#")]),v._v(" 同时打开会怎样？")]),v._v(" "),t("p",[v._v("如果双方同时发 "),t("code",[v._v("SYN")]),v._v("报文，状态变化会是怎样的呢？")]),v._v(" "),t("p",[v._v("这是一个可能会发生的情况。")]),v._v(" "),t("p",[v._v("状态变迁如下:")]),v._v(" "),t("p",[t("img",{attrs:{src:v.$withBase("/tcp/013.jpg")}})]),v._v(" "),t("p",[v._v("在发送方给接收方发"),t("code",[v._v("SYN")]),v._v("报文的同时，接收方也给发送方发"),t("code",[v._v("SYN")]),v._v("报文，两个人刚上了!")]),v._v(" "),t("p",[v._v("发完"),t("code",[v._v("SYN")]),v._v("，两者的状态都变为"),t("code",[v._v("SYN-SENT")]),v._v("。")]),v._v(" "),t("p",[v._v("在各自收到对方的"),t("code",[v._v("SYN")]),v._v("后，两者状态都变为"),t("code",[v._v("SYN-REVD")]),v._v("。")]),v._v(" "),t("p",[v._v("接着会回复对应的"),t("code",[v._v("ACK + SYN")]),v._v("，这个报文在对方接收之后，两者状态一起变为"),t("code",[v._v("ESTABLISHED")]),v._v("。")]),v._v(" "),t("p",[v._v("这就是同时打开情况下的状态变迁。")])])}),[],!1,null,null,null);_.default=o.exports}}]);